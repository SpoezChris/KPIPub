<script>
  // CHANGE THIS ONE LINE AFTER STEP 4: Your Vercel proxy URL
  const PROXY_URL = "https://kpi-pub.vercel.app";

  window.handleNotionResponse = function(data) {
    const winrateEl = document.getElementById("winrate");
    if (data.winrate !== null && data.winrate !== undefined) {
      winrateEl.textContent = data.winrate + "%";
    } else {
      winrateEl.textContent = "—";
    }
  };

  async function loadWinRate() {
    const winrateEl = document.getElementById("winrate");
    winrateEl.textContent = "…"; // Loading

    try {
      const res = await fetch(PROXY_URL + "?cache=" + Date.now());
      const data = await res.json();
      window.handleNotionResponse(data); // Use the handler for consistency
    } catch (e) {
      winrateEl.textContent = "—";
      console.error("Load error:", e);
    }
  }

  loadWinRate();
  setInterval(loadWinRate, 60000); // Every minute
</script>
